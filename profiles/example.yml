git:
  branch: master
  repo: git@github.com:newnoiseworks/tpl-game-gd.git
  # repo: .


main:
  - name: infra
    dir: server/infra
    steps: 
      - cmd: gg build-templates .
      - cmd: ./infra_deploy.sh
        dir: gcp # infers ./server/infra/gcp based on top level dir
  - name: setup-ip
    steps:
      - cmd: gg update-resource profiles/example.yml nakama.host $(./get_ip.sh)
  - name: game-client
    dir: game
    steps: 
      - cmd: gg build-templates .
      - cmd: ./build_clients.sh
      - cmd: ./deploy_clients.sh
  - name: nakama-server
    dir: server
    steps: 
      - cmd: gg build-templates .
      - cmd: ./build_server.sh
      - cmd: ./deploy/gcp/deploy.sh


tasks:
  - name: destroy-infra
    cmd: ./destroy_infra.sh
    dir: server/infra



## TPL stuff to remove?

# gcloud:
#   project: projectname
#   region: us-east1
#   cloudZone: us-east1-b
#

nakama:
  host: 127.0.0.1
  port: 7350
  secure: false

game:
  real_world_seconds_per_day: 12 * 60
  version: 0.1.23
